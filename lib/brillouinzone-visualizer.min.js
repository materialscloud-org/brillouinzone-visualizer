// Materials Cloud bands structure widget v0.1.0-beta.9
// https://www.materialscloud.org
// Contributors: [object Object]
// (c) 2022, Released under the MIT License

var THREE=require("three/build/three.module");THREE.OrbitControls=function(e,t){var n,o,i,r,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),h=d.NONE},this.update=(n=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=o.clone().inverse(),r=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=s.object.position;return n.copy(e).sub(s.target),n.applyQuaternion(o),u.setFromVector3(n),s.autoRotate&&h===d.NONE&&O(2*Math.PI/60/60*s.autoRotateSpeed),u.theta+=m.theta,u.phi+=m.phi,u.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,u.theta)),u.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=b,u.radius=Math.max(s.minDistance,Math.min(s.maxDistance,u.radius)),s.target.add(f),n.setFromSpherical(u),n.applyQuaternion(i),e.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor):m.set(0,0,0),b=1,f.set(0,0,0),!!(g||r.distanceToSquared(s.object.position)>E||8*(1-a.dot(s.object.quaternion))>E)&&(s.dispatchEvent(l),r.copy(s.object.position),a.copy(s.object.quaternion),!(g=!1))}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",Y,!1),s.domElement.removeEventListener("mousedown",P,!1),s.domElement.removeEventListener("wheel",G,!1),s.domElement.removeEventListener("touchstart",U,!1),s.domElement.removeEventListener("touchend",I,!1),s.domElement.removeEventListener("touchmove",W,!1),document.removeEventListener("mousemove",D,!1),document.removeEventListener("mouseup",F,!1),window.removeEventListener("keydown",Z,!1)};var s=this,l={type:"change"},c={type:"start"},p={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},h=d.NONE,E=1e-6,u=new THREE.Spherical,m=new THREE.Spherical,b=1,f=new THREE.Vector3,g=!1,y=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector2,R=new THREE.Vector2,T=new THREE.Vector2,H=new THREE.Vector2,x=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2;function V(){return Math.pow(.95,s.zoomSpeed)}function O(e){m.theta-=e}function _(e){m.phi-=e}var C,j,L,z=(C=new THREE.Vector3,function(e,t){C.setFromMatrixColumn(t,0),C.multiplyScalar(-e),f.add(C)}),A=(j=new THREE.Vector3,function(e,t){j.setFromMatrixColumn(t,1),j.multiplyScalar(e),f.add(j)}),k=(L=new THREE.Vector3,function(e,t){var n,o=s.domElement===document?s.domElement.body:s.domElement;s.object instanceof THREE.PerspectiveCamera?(n=s.object.position,L.copy(n).sub(s.target),n=L.length(),n*=Math.tan(s.object.fov/2*Math.PI/180),z(2*e*n/o.clientHeight,s.object.matrix),A(2*t*n/o.clientHeight,s.object.matrix)):s.object instanceof THREE.OrthographicCamera?(z(e*(s.object.right-s.object.left)/s.object.zoom/o.clientWidth,s.object.matrix),A(t*(s.object.top-s.object.bottom)/s.object.zoom/o.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)});function N(e){s.object instanceof THREE.PerspectiveCamera?b/=e:s.object instanceof THREE.OrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function B(e){s.object instanceof THREE.PerspectiveCamera?b*=e:s.object instanceof THREE.OrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function P(e){if(!1!==s.enabled){if(e.preventDefault(),e.button===s.mouseButtons.ORBIT){if(!1===s.enableRotate)return;t=e,y.set(t.clientX,t.clientY),h=d.ROTATE}else if(e.button===s.mouseButtons.ZOOM){if(!1===s.enableZoom)return;t=e,x.set(t.clientX,t.clientY),h=d.DOLLY}else if(e.button===s.mouseButtons.PAN){if(!1===s.enablePan)return;e=e,R.set(e.clientX,e.clientY),h=d.PAN}var t;h!==d.NONE&&(document.addEventListener("mousemove",D,!1),document.addEventListener("mouseup",F,!1),s.dispatchEvent(c))}}function D(e){var t;!1!==s.enabled&&(e.preventDefault(),h===d.ROTATE?!1!==s.enableRotate&&(t=e,v.set(t.clientX,t.clientY),w.subVectors(v,y),t=s.domElement===document?s.domElement.body:s.domElement,O(2*Math.PI*w.x/t.clientWidth*s.rotateSpeed),_(2*Math.PI*w.y/t.clientHeight*s.rotateSpeed),y.copy(v),s.update()):h===d.DOLLY?!1!==s.enableZoom&&(t=e,M.set(t.clientX,t.clientY),S.subVectors(M,x),0<S.y?N(V()):S.y<0&&B(V()),x.copy(M),s.update()):h===d.PAN&&!1!==s.enablePan&&(e=e,T.set(e.clientX,e.clientY),H.subVectors(T,R),k(H.x,H.y),R.copy(T),s.update()))}function F(e){!1!==s.enabled&&(document.removeEventListener("mousemove",D,!1),document.removeEventListener("mouseup",F,!1),s.dispatchEvent(p),h=d.NONE)}function G(e){!1===s.enabled||!1===s.enableZoom||h!==d.NONE&&h!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),(e=e).deltaY<0?B(V()):0<e.deltaY&&N(V()),s.update(),s.dispatchEvent(c),s.dispatchEvent(p))}function Z(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:k(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:k(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:k(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:k(-s.keyPanSpeed,0),s.update()}}(e)}function U(e){if(!1!==s.enabled){switch(e.touches.length){case 1:if(!1===s.enableRotate)return;n=e,y.set(n.touches[0].pageX,n.touches[0].pageY),h=d.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom)return;n=(t=e).touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,t=Math.sqrt(n*n+t*t),x.set(0,t),h=d.TOUCH_DOLLY;break;case 3:if(!1===s.enablePan)return;t=e,R.set(t.touches[0].pageX,t.touches[0].pageY),h=d.TOUCH_PAN;break;default:h=d.NONE}var t,n;h!==d.NONE&&s.dispatchEvent(c)}}function W(e){var t,n;if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(h!==d.TOUCH_ROTATE)return;n=e,v.set(n.touches[0].pageX,n.touches[0].pageY),w.subVectors(v,y),n=s.domElement===document?s.domElement.body:s.domElement,O(2*Math.PI*w.x/n.clientWidth*s.rotateSpeed),_(2*Math.PI*w.y/n.clientHeight*s.rotateSpeed),y.copy(v),s.update();break;case 2:if(!1===s.enableZoom)return;if(h!==d.TOUCH_DOLLY)return;n=(t=e).touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,t=Math.sqrt(n*n+t*t),M.set(0,t),S.subVectors(M,x),0<S.y?B(V()):S.y<0&&N(V()),x.copy(M),s.update();break;case 3:if(!1===s.enablePan)return;if(h!==d.TOUCH_PAN)return;t=e,T.set(t.touches[0].pageX,t.touches[0].pageY),H.subVectors(T,R),k(H.x,H.y),R.copy(T),s.update();break;default:h=d.NONE}}function I(e){!1!==s.enabled&&(s.dispatchEvent(p),h=d.NONE)}function Y(e){e.preventDefault()}s.domElement.addEventListener("contextmenu",Y,!1),s.domElement.addEventListener("mousedown",P,!1),s.domElement.addEventListener("wheel",G,!1),s.domElement.addEventListener("touchstart",U,!1),s.domElement.addEventListener("touchend",I,!1),s.domElement.addEventListener("touchmove",W,!1),window.addEventListener("keydown",Z,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var ie,re,i,ae,se,le,ce,pe,de,he,Ee,ue=[],me=0,be=[],t=0,n=[],o=0,r=[],a=0,fe=[],ge=0,ye={objects:[],lights:[],elements:[]},ve=new THREE.Vector3,we=new THREE.Vector4,s=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),m=new THREE.Box3,b=new Array(3),Re=(new Array(4),new THREE.Matrix4),Te=new THREE.Matrix4,He=new THREE.Matrix4,xe=new THREE.Matrix3,Me=new THREE.Frustum,Se=new THREE.Vector4,Ve=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var Oe=new function(){var l=[],c=[],p=null,d=null,h=new THREE.Matrix3;function o(e){var t=e.position,n=e.positionWorld,o=e.positionScreen;n.copy(t).applyMatrix4(Ee),o.copy(n).applyMatrix4(Te);n=1/o.w;o.x*=n,o.y*=n,o.z*=n,e.visible=-1<=o.x&&o.x<=1&&-1<=o.y&&o.y<=1&&-1<=o.z&&o.z<=1}function E(e,t,n){return!0===e.visible||!0===t.visible||!0===n.visible||(b[0]=e.positionScreen,b[1]=t.positionScreen,b[2]=n.positionScreen,s.intersectsBox(m.setFromPoints(b)))}function u(e,t,n){return(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){d=(p=e).material,h.getNormalMatrix(p.matrixWorld),l.length=0,c.length=0},projectVertex:o,checkTriangleVisibility:E,checkBackfaceCulling:u,pushVertex:function(e,t,n){(i=_e()).position.set(e,t,n),o(i)},pushNormal:function(e,t,n){l.push(e,t,n)},pushUv:function(e,t){c.push(e,t)},pushLine:function(e,t){e=be[e],t=be[t],(ce=je()).id=p.id,ce.v1.copy(e),ce.v2.copy(t),ce.z=(e.positionScreen.z+t.positionScreen.z)/2,ce.renderOrder=p.renderOrder,ce.material=p.material,ye.elements.push(ce)},pushTriangle:function(e,t,n){var o=be[e],i=be[t],r=be[n];if(!1!==E(o,i,r)&&(d.side===THREE.DoubleSide||!0===u(o,i,r))){(se=Ce()).id=p.id,se.v1.copy(o),se.v2.copy(i),se.v3.copy(r),se.z=(o.positionScreen.z+i.positionScreen.z+r.positionScreen.z)/3,se.renderOrder=p.renderOrder,se.normalModel.fromArray(l,3*e),se.normalModel.applyMatrix3(h).normalize();for(var a=0;a<3;a++){var s=se.vertexNormalsModel[a];s.fromArray(l,3*arguments[a]),s.applyMatrix3(h).normalize(),se.uvs[a].fromArray(c,2*arguments[a])}se.vertexNormalsLength=3,se.material=p.material,ye.elements.push(se)}}}};function _e(){if(ae!==t)return be[ae++];var e=new THREE.RenderableVertex;return be.push(e),t++,ae++,e}function Ce(){if(le!==o)return n[le++];var e=new THREE.RenderableFace;return n.push(e),o++,le++,e}function je(){if(pe!==a)return r[pe++];var e=new THREE.RenderableLine;return r.push(e),a++,pe++,e}function Le(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,t,n,o){function i(e){(ie=function(){if(re!==me)return ue[re++];var e=new THREE.RenderableObject;return ue.push(e),me++,re++,e}()).id=e.id,ie.object=e,ve.setFromMatrixPosition(e.matrixWorld),ve.applyMatrix4(Te),ie.z=ve.z,ie.renderOrder=e.renderOrder,ye.objects.push(ie)}he=pe=le=0,!(ye.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Re.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),Te.multiplyMatrices(t.projectionMatrix,Re),Me.setFromMatrix(Te),re=0,ye.objects.length=0,ye.lights.length=0,e.traverseVisible(function(e){e instanceof THREE.Light?ye.lights.push(e):e instanceof THREE.Mesh||e instanceof THREE.Line?!1!==e.material.visible&&(!0===e.frustumCulled&&!1===Me.intersectsObject(e)||i(e)):e instanceof THREE.Sprite&&!1!==e.material.visible&&(!0===e.frustumCulled&&!1===Me.intersectsSprite(e)||i(e))}),!0===n&&ye.objects.sort(Le);for(var r,a,s,l,c,p,d,h,E=0,u=ye.objects.length;E<u;E++){var m,b=ye.objects[E].object,f=b.geometry;if(Oe.setObject(b),Ee=b.matrixWorld,ae=0,b instanceof THREE.Mesh){if(f instanceof THREE.BufferGeometry){var g=f.attributes,y=f.groups;if(void 0!==g.position){for(var v=0,w=(ne=g.position.array).length;v<w;v+=3)Oe.pushVertex(ne[v],ne[v+1],ne[v+2]);if(void 0!==g.normal)for(var R=g.normal.array,v=0,w=R.length;v<w;v+=3)Oe.pushNormal(R[v],R[v+1],R[v+2]);if(void 0!==g.uv)for(var T=g.uv.array,v=0,w=T.length;v<w;v+=2)Oe.pushUv(T[v],T[v+1]);if(null!==f.index){var H=f.index.array;if(0<y.length)for(var x=0;x<y.length;x++)for(var M=y[x],v=M.start,w=M.start+M.count;v<w;v+=3)Oe.pushTriangle(H[v],H[v+1],H[v+2]);else for(v=0,w=H.length;v<w;v+=3)Oe.pushTriangle(H[v],H[v+1],H[v+2])}else for(v=0,w=ne.length/3;v<w;v+=3)Oe.pushTriangle(v,v+1,v+2)}}else if(f instanceof THREE.Geometry){var S=f.vertices,V=f.faces,O=f.faceVertexUvs[0];xe.getNormalMatrix(Ee);for(var _=(Z=b.material)instanceof THREE.MultiMaterial,C=!0==_?b.material:null,j=0,L=S.length;j<L;j++){var z=S[j];if(ve.copy(z),!0===Z.morphTargets)for(var A=f.morphTargets,k=b.morphTargetInfluences,N=0,B=A.length;N<B;N++){var P,D=k[N];0!==D&&(P=A[N].vertices[j],ve.x+=(P.x-z.x)*D,ve.y+=(P.y-z.y)*D,ve.z+=(P.z-z.z)*D)}Oe.pushVertex(ve.x,ve.y,ve.z)}for(var F=0,G=V.length;F<G;F++){var Z,U=V[F];if(void 0!==(Z=!0==_?C.materials[U.materialIndex]:b.material)){var W=Z.side,I=be[U.a],Y=be[U.b],X=be[U.c];if(!1!==Oe.checkTriangleVisibility(I,Y,X)){var q=Oe.checkBackfaceCulling(I,Y,X);if(W!==THREE.DoubleSide){if(W===THREE.FrontSide&&!1===q)continue;if(W===THREE.BackSide&&!0===q)continue}(se=Ce()).id=b.id,se.v1.copy(I),se.v2.copy(Y),se.v3.copy(X),se.normalModel.copy(U.normal),!1!==q||W!==THREE.BackSide&&W!==THREE.DoubleSide||se.normalModel.negate(),se.normalModel.applyMatrix3(xe).normalize();for(var J=U.vertexNormals,K=0,Q=Math.min(J.length,3);K<Q;K++){var $=se.vertexNormalsModel[K];$.copy(J[K]),!1!==q||W!==THREE.BackSide&&W!==THREE.DoubleSide||$.negate(),$.applyMatrix3(xe).normalize()}se.vertexNormalsLength=J.length;var ee=O[F];if(void 0!==ee)for(var te=0;te<3;te++)se.uvs[te].copy(ee[te]);se.color=U.color,se.material=Z,se.z=(I.positionScreen.z+Y.positionScreen.z+X.positionScreen.z)/3,se.renderOrder=b.renderOrder,ye.elements.push(se)}}}}}else if(b instanceof THREE.Line){if(f instanceof THREE.BufferGeometry){if(void 0!==(g=f.attributes).position){for(var ne,v=0,w=(ne=g.position.array).length;v<w;v+=3)Oe.pushVertex(ne[v],ne[v+1],ne[v+2]);if(null!==f.index)for(v=0,w=(H=f.index.array).length;v<w;v+=2)Oe.pushLine(H[v],H[v+1]);else for(var oe=b instanceof THREE.LineSegments?2:1,v=0,w=ne.length/3-1;v<w;v+=oe)Oe.pushLine(v,v+1)}}else if(f instanceof THREE.Geometry)if(He.multiplyMatrices(Te,Ee),0!==(S=b.geometry.vertices).length){(I=_e()).positionScreen.copy(S[0]).applyMatrix4(He);for(oe=b instanceof THREE.LineSegments?2:1,j=1,L=S.length;j<L;j++)(I=_e()).positionScreen.copy(S[j]).applyMatrix4(He),0<(j+1)%oe||(Y=be[ae-2],Se.copy(I.positionScreen),Ve.copy(Y.positionScreen),!0==(a=Ve,h=d=p=c=l=s=void 0,s=0,l=1,c=(r=Se).z+r.w,p=a.z+a.w,d=-r.z+r.w,h=-a.z+a.w,0<=c&&0<=p&&0<=d&&0<=h||!(c<0&&p<0||d<0&&h<0)&&(c<0?s=Math.max(s,c/(c-p)):p<0&&(l=Math.min(l,c/(c-p))),d<0?s=Math.max(s,d/(d-h)):h<0&&(l=Math.min(l,d/(d-h))),!(l<s)&&(r.lerp(a,s),a.lerp(r,1-l),!0)))&&(Se.multiplyScalar(1/Se.w),Ve.multiplyScalar(1/Ve.w),(ce=je()).id=b.id,ce.v1.positionScreen.copy(Se),ce.v2.positionScreen.copy(Ve),ce.z=Math.max(Se.z,Ve.z),ce.renderOrder=b.renderOrder,ce.material=b.material,b.material.vertexColors===THREE.VertexColors&&(ce.vertexColors[0].copy(b.geometry.colors[j]),ce.vertexColors[1].copy(b.geometry.colors[j-1])),ye.elements.push(ce)))}}else b instanceof THREE.Sprite&&(we.set(Ee.elements[12],Ee.elements[13],Ee.elements[14],1),we.applyMatrix4(Te),m=1/we.w,we.z*=m,-1<=we.z&&we.z<=1&&((de=function(){if(he!==ge)return fe[he++];var e=new THREE.RenderableSprite;return fe.push(e),ge++,he++,e}()).id=b.id,de.x=we.x*m,de.y=we.y*m,de.z=we.z,de.renderOrder=b.renderOrder,de.object=b,de.rotation=b.rotation,de.scale.x=b.scale.x*Math.abs(de.x-(we.x+t.projectionMatrix.elements[0])/(we.w+t.projectionMatrix.elements[12])),de.scale.y=b.scale.y*Math.abs(de.y-(we.y+t.projectionMatrix.elements[5])/(we.w+t.projectionMatrix.elements[13])),de.material=b.material,ye.elements.push(de)))}return!0===o&&ye.elements.sort(Le),ye}},THREE.SVGObject=function(e){THREE.Object3D.call(this),this.node=e},THREE.SVGObject.prototype=Object.create(THREE.Object3D.prototype),THREE.SVGObject.prototype.constructor=THREE.SVGObject,THREE.SVGRenderer=function(){console.log("THREE.SVGRenderer",THREE.REVISION);var p,d,h,n,o,E,u,m,b,f,g,y=this,v=new THREE.Projector,w=document.createElementNS("http://www.w3.org/2000/svg","svg"),R=new THREE.Box2,T=new THREE.Box2,H=new THREE.Color,x=new THREE.Color,M=new THREE.Color,S=new THREE.Color,V=new THREE.Color,i=new THREE.Color,r=1,O=new THREE.Vector3,_=new THREE.Vector3,C=new THREE.Vector3,j=new THREE.Matrix3,L=new THREE.Matrix4,z=new THREE.Matrix4,A=[],k=[],N=[],B=0,P=0,D=0,F=1;function G(){for(D=P=B=0;0<w.childNodes.length;)w.removeChild(w.childNodes[0])}this.domElement=w,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":F=1;break;case"low":F=0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setClearColor=function(e,t){i.set(e),r=void 0!==t?t:1},this.setPixelRatio=function(){},this.setSize=function(e,t){E=(n=e)/2,u=(o=t)/2,w.setAttribute("viewBox",-E+" "+-u+" "+n+" "+o),w.setAttribute("width",n),w.setAttribute("height",o),R.min.set(-E,-u),R.max.set(E,u)},this.clear=function(){G(),w.style.backgroundColor="rgba("+Math.floor(255*i.r)+","+Math.floor(255*i.g)+","+Math.floor(255*i.b)+","+r+")"},this.render=function(e,t){if(t instanceof THREE.Camera!=!1){var n=e.background;n&&n.isColor?(G(),w.style.backgroundColor="rgb("+Math.floor(255*n.r)+","+Math.floor(255*n.g)+","+Math.floor(255*n.b)+")"):!0===this.autoClear&&this.clear(),y.info.render.vertices=0,y.info.render.faces=0,L.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),z.multiplyMatrices(t.projectionMatrix,L),p=v.projectScene(e,t,this.sortObjects,this.sortElements),d=p.elements,h=p.lights,j.getNormalMatrix(t.matrixWorldInverse),function(e){M.setRGB(0,0,0),S.setRGB(0,0,0),V.setRGB(0,0,0);for(var t=0,n=e.length;t<n;t++){var o=e[t],i=o.color;o instanceof THREE.AmbientLight?(M.r+=i.r,M.g+=i.g,M.b+=i.b):o instanceof THREE.DirectionalLight?(S.r+=i.r,S.g+=i.g,S.b+=i.b):o instanceof THREE.PointLight&&(V.r+=i.r,V.g+=i.g,V.b+=i.b)}}(h);for(var o,i,r,a=0,s=d.length;a<s;a++){var l=d[a],c=l.material;void 0!==c&&0!==c.opacity&&(T.makeEmpty(),l instanceof THREE.RenderableSprite?((m=l).x*=E,m.y*=-u,function(e,t,n){var o=t.scale.x*E,t=t.scale.y*u;(g=function(e){if(null!=N[e])return N[e];N[e]=document.createElementNS("http://www.w3.org/2000/svg","rect"),0==F&&N[e].setAttribute("shape-rendering","crispEdges");return N[e]}(D++)).setAttribute("x",e.x-.5*o),g.setAttribute("y",e.y-.5*t),g.setAttribute("width",o),g.setAttribute("height",t),n instanceof THREE.SpriteMaterial&&g.setAttribute("style","fill: "+n.color.getStyle());w.appendChild(g)}(m,l,c)):l instanceof THREE.RenderableLine?(m=l.v1,b=l.v2,m.positionScreen.x*=E,m.positionScreen.y*=-u,b.positionScreen.x*=E,b.positionScreen.y*=-u,T.setFromPoints([m.positionScreen,b.positionScreen]),!0===R.intersectsBox(T)&&(o=m,i=b,r=c,(g=function(e){if(null!=k[e])return k[e];k[e]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==F&&k[e].setAttribute("shape-rendering","crispEdges");return k[e]}(P++)).setAttribute("x1",o.positionScreen.x),g.setAttribute("y1",o.positionScreen.y),g.setAttribute("x2",i.positionScreen.x),g.setAttribute("y2",i.positionScreen.y),r instanceof THREE.LineBasicMaterial&&(g.setAttribute("style","fill: none; stroke: "+r.color.getStyle()+"; stroke-width: "+r.linewidth+"; stroke-opacity: "+r.opacity+"; stroke-linecap: "+r.linecap+"; stroke-linejoin: "+r.linejoin),w.appendChild(g)))):l instanceof THREE.RenderableFace&&(m=l.v1,b=l.v2,f=l.v3,m.positionScreen.z<-1||1<m.positionScreen.z||b.positionScreen.z<-1||1<b.positionScreen.z||f.positionScreen.z<-1||1<f.positionScreen.z||(m.positionScreen.x*=E,m.positionScreen.y*=-u,b.positionScreen.x*=E,b.positionScreen.y*=-u,f.positionScreen.x*=E,f.positionScreen.y*=-u,T.setFromPoints([m.positionScreen,b.positionScreen,f.positionScreen]),!0===R.intersectsBox(T)&&function(e,t,n,o,i){y.info.render.vertices+=3,y.info.render.faces++,(g=function(e){if(null!=A[e])return A[e];A[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==F&&A[e].setAttribute("shape-rendering","crispEdges");return A[e]}(B++)).setAttribute("d","M "+e.positionScreen.x+" "+e.positionScreen.y+" L "+t.positionScreen.x+" "+t.positionScreen.y+" L "+n.positionScreen.x+","+n.positionScreen.y+"z"),i instanceof THREE.MeshBasicMaterial?(H.copy(i.color),i.vertexColors===THREE.FaceColors&&H.multiply(o.color)):i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial?(x.copy(i.color),i.vertexColors===THREE.FaceColors&&x.multiply(o.color),H.copy(M),_.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),function(e,t,n,o){for(var i=0,r=e.length;i<r;i++){var a,s,l=e[i],c=l.color;l instanceof THREE.DirectionalLight?(a=O.setFromMatrixPosition(l.matrixWorld).normalize(),(s=n.dot(a))<=0||(s*=l.intensity,o.r+=c.r*s,o.g+=c.g*s,o.b+=c.b*s)):l instanceof THREE.PointLight&&(a=O.setFromMatrixPosition(l.matrixWorld),(s=n.dot(O.subVectors(a,t).normalize()))<=0||0!=(s*=0==l.distance?1:1-Math.min(t.distanceTo(a)/l.distance,1))&&(s*=l.intensity,o.r+=c.r*s,o.g+=c.g*s,o.b+=c.b*s))}}(h,_,o.normalModel,H),H.multiply(x).add(i.emissive)):i instanceof THREE.MeshNormalMaterial&&(C.copy(o.normalModel).applyMatrix3(j),H.setRGB(C.x,C.y,C.z).multiplyScalar(.5).addScalar(.5));i.wireframe?g.setAttribute("style","fill: none; stroke: "+H.getStyle()+"; stroke-width: "+i.wireframeLinewidth+"; stroke-opacity: "+i.opacity+"; stroke-linecap: "+i.wireframeLinecap+"; stroke-linejoin: "+i.wireframeLinejoin):g.setAttribute("style","fill: "+H.getStyle()+"; fill-opacity: "+i.opacity);w.appendChild(g)}(m,b,f,l,c))))}e.traverseVisible(function(e){var t,n;e instanceof THREE.SVGObject&&(O.setFromMatrixPosition(e.matrixWorld),O.applyMatrix4(z),t=O.x*E,n=-O.y*u,(e=e.node).setAttribute("transform","translate("+t+","+n+")"),w.appendChild(e))})}else console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera.")}};var prettifyLabel=function(e,t){return t=void 0!==t&&t,e=(e=(e=(e=(e=e.replace(/GAMMA/gi,"&Gamma;")).replace(/DELTA/gi,"&Delta;")).replace(/SIGMA/gi,"&Sigma;")).replace(/LAMBDA/gi,"&Lambda;")).replace(/\-/gi,"&mdash;"),e=t?e.replace(/_(.)/gi,function(e,t,n,o){return'<tspan baseline-shift="sub">'+t+"</tspan>"}):e.replace(/_(.)/gi,function(e,t,n,o){return"<sub>"+t+"</sub>"})},BZVisualizer=function(f,g,y,v,n){f=void 0===f||f,g=void 0===g||g,y=void 0!==y&&y,n=void 0!==n&&n,v=void 0!==v&&v,console.log("Init BZVisualizer");var w=null,R=[],T=new THREE.MeshBasicMaterial({color:13975119,opacity:.5,transparent:!0}),H=new THREE.LineBasicMaterial({color:3355443,opacity:1,transparent:!1,linewidth:1}),x=new THREE.LineBasicMaterial({color:285405,opacity:1,transparent:!1}),M=new THREE.MeshBasicMaterial({color:3311805,opacity:1,transparent:!1}),S=new THREE.MeshBasicMaterial({color:8925746,opacity:1,transparent:!1}),V=null,O=null,_=!1,C=null,j=null,L=null;this.loadBZAjax=function(e,t,o){document.getElementById(o).innerHTML="Loading...",$.getJSON(newpath_to_load,function(e){loadBZ(t,o,e,n)}).fail(function(e,t,n){n=t+", "+n;console.log("Request Failed: "+n),document.getElementById(o).innerHTML="Request Failed: "+n})},this.resizeRenderer=function(){var e,t;L&&(e=document.getElementById(L),t=window.devicePixelRatio||1,canvas3d_width=e.offsetWidth,canvas3d_height=e.offsetHeight,j&&(O.aspect=canvas3d_width/canvas3d_height,O.updateProjectionMatrix(),j.setSize(canvas3d_width*t,canvas3d_height*t),j.domElement.style.width=canvas3d_width+"px",j.domElement.style.height=canvas3d_height+"px",j.domElement.width=canvas3d_width*t,j.domElement.height=canvas3d_height*t),k())};function z(e){var t=document.createElement("div");t.classList.add(e),t.style.position="absolute",t.style.fontFamily="'Helvetica Neue', Helvetica, Arial, sans-serif",t.style.zIndex=1,t.style.width="100%",t.style.height="100%",t.style.display="table",t.style.top="0px",t.style.left="0px",t.style.textAlign="center",t.style.verticalAlign="middle",t.style.userSelect="none",t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozUserSelect="none",t.setAttribute("unselectable","on");var n=document.createElement("span");return n.style.color="rgb(80, 80, 80)",n.style.fontSize="24px",n.style.fontWeight="bold",n.style.backgroundColor="rgba(230,230,230,0.5)",n.style.display="table-cell",n.style.verticalAlign="middle",n.style.lineHeight="normal",n.style.userSelect="none",n.style.userSelect="none",n.style.webkitUserSelect="none",n.style.MozUserSelect="none",n.setAttribute("unselectable","on"),(e=document.createElement("button")).innerHTML="Enable Interaction",e.style.fontSize="20px",e.style.verticalAlign="left",e.classList.add("DouButton"),n.appendChild(e),t.appendChild(n),t}var A=function(e,t){var n,o;return t=void 0!==t?t:"#000000",v?((o=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("y",-100),o.setAttribute("x",-100),o.setAttribute("font-family","'Helvetica Neue', Helvetica, Arial, sans-serif"),n=window.devicePixelRatio||1,o.setAttribute("font-size",12*n+"px"),o.setAttribute("fill",t),o.innerHTML=e):((o=document.createElement("div")).style.position="absolute",o.style.fontFamily="'Helvetica Neue', Helvetica, Arial, sans-serif",o.style.color=t,o.style.width=100,o.style.height=100,o.style.fontSize="12px",o.innerHTML=e,o.style.top="-100px",o.style.left="-100px",o.style.userSelect="none",o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.setAttribute("unselectable","on"),o.style.pointerEvents="none"),o};function o(e,t){var n,o,e=e.clone().project(t),t=window.devicePixelRatio||1;return v?(n=.5*j.domElement.viewBox.baseVal.width,o=.5*j.domElement.viewBox.baseVal.height,j.domElement.viewBox.baseVal.x,j.domElement.viewBox.baseVal.y,e.x=e.x*n,e.y=-e.y*o):(n=.5*j.getContext().canvas.width/t,o=.5*j.getContext().canvas.height/t,e.x=e.x*n+n,e.y=-e.y*o+o),{left:e.x,top:e.y}}function k(){var e;null!=C?(console.log("setting cam at start of render"),console.log(JSON.stringify(C)),e=new THREE.Vector3,O.getWorldDirection(e),console.log("worlddir before renderer.render is"),console.log(JSON.stringify(e)),console.log("controls.target=="),console.log(JSON.stringify(w.target))):console.log("camdir == null in render()"),j.render(V,O),v?R.forEach(function(e){pos=e[0],textcontent=e[1],t=2<e.length?(the_color=e[2],A(textcontent,the_color)):A(textcontent),pos2d=o(pos,O),t.setAttribute("y",pos2d.top),t.setAttribute("x",pos2d.left),j.domElement.appendChild(t)}):R.forEach(function(e){pos=e[0],text=e[1],pos2d=o(pos,O),text.style.top=pos2d.top+"px",text.style.left=pos2d.left+"px"})}this.loadBZ=function(e,t,n,o){L=e;var i=document.getElementById(e),e=window.devicePixelRatio||1;for(document.getElementById(t).innerHTML="";i.firstChild;)i.removeChild(i.firstChild);R=[];t=new THREE.Vector3;null!=w?(_=!0,console.log(w.getAzimuthalAngle()),c=new THREE.Vector3(0,0,-1).applyMatrix4(O.matrixWorld),C=c.sub(O.position).normalize(),O.getWorldDirection(t),console.log(JSON.stringify(t))):console.log("controls is null"),V=new THREE.Scene,canvas3d_width=i.offsetWidth,canvas3d_height=i.offsetHeight,null!=w?(console.log(JSON.stringify(C)),O.lookAt(C),w.target=C,O.getWorldDirection(t),console.log("worlddir after camera declaration is"),console.log(JSON.stringify(t))):console.log("controls is null but probably shouldn't be?"),j.setClearColor(16777215,0),j.setSize(canvas3d_width*e,canvas3d_height*e),j.domElement.style.width=canvas3d_width+"px",j.domElement.style.height=canvas3d_height+"px",j.domElement.width=canvas3d_width*e,j.domElement.height=canvas3d_height*e,i.appendChild(j.domElement),w.addEventListener("change",k),w.enableDamping=!0,w.dampingFactor=.25,w.enableZoom=!0,special_points=n.kpoints,b1=n.b1,b2=n.b2,b3=n.b3,max_b_length=Math.sqrt(Math.max(Math.pow(b1[0],2)+Math.pow(b1[1],2)+Math.pow(b1[2],2),Math.pow(b2[0],2)+Math.pow(b2[1],2)+Math.pow(b2[2],2),Math.pow(b3[0],2)+Math.pow(b3[1],2)+Math.pow(b3[2],2)));var r=1.5*max_b_length;for(s in data=n.faces_data,special_points){pos=special_points[s],radius=.02*max_b_length;var a=new THREE.SphereGeometry(radius,16,16);(h=new THREE.Mesh(a,M)).translateX(pos[0]),h.translateY(pos[1]),h.translateZ(pos[2]),V.add(h);var s=prettifyLabel(s,forSVG=v),l=A(s);v?(j.domElement.appendChild(l),R.push([new THREE.Vector3(pos[0],pos[1],pos[2]),s])):(i.appendChild(l),R.push([new THREE.Vector3(pos[0],pos[1],pos[2]),l]))}f&&(axesLabels=[[new THREE.Vector3(1,0,0),'<span style="font-style: italic">x</span>'],[new THREE.Vector3(0,1,0),'<span style="font-style: italic">y</span>'],[new THREE.Vector3(0,0,1),'<span style="font-style: italic">z</span>']],v&&(axesLabels=[[new THREE.Vector3(1,0,0),'<tspan style="font-style: italic">x</tspan>'],[new THREE.Vector3(0,1,0),'<tspan style="font-style: italic">y</tspan>'],[new THREE.Vector3(0,0,1),'<tspan style="font-style: italic">z</tspan>']]),axesLabels.forEach(function(e){dir=e[0],s=e[1];var t=new THREE.Vector3(0,0,0),e=new THREE.ArrowHelper(dir,t,r,5592405,headLength=r/10,headwidth=r/20);V.add(e),the_color="#555555",l=A(s,color=the_color),pos=dir.clone(),pos.sub(t),pos.multiplyScalar(r),v?(j.domElement.appendChild(l),R.push([pos,s,the_color])):(i.appendChild(l),R.push([pos,l]))}));var c=[[b1,'<span style="font-weight: bold">b</span><sub>1</sub>'],[b2,'<span style="font-weight: bold">b</span><sub>2</sub>'],[b3,'<span style="font-weight: bold">b</span><sub>3</sub>']];v&&(c=[[b1,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">1</tspan>'],[b2,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">2</tspan>'],[b3,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">3</tspan>']]),(c=!g?[]:c).forEach(function(e){b=e[0],s=e[1],b_length=Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)),dir=new THREE.Vector3(b[0]/b_length,b[1]/b_length,b[2]/b_length);var t=new THREE.Vector3(0,0,0),e=new THREE.ArrowHelper(dir,t,length=b_length,0,headLength=b_length/10,headwidth=b_length/20);V.add(e);e=A(s);pos=dir.clone(),pos.sub(t),pos.multiplyScalar(b_length),v?(j.domElement.appendChild(e),R.push([pos,s])):(i.appendChild(e),R.push([pos,e]))});var p=new THREE.Geometry;data.triangles_vertices.forEach(function(e){p.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))}),data.triangles.forEach(function(e){p.faces.push(new THREE.Face3(e[0],e[1],e[2]))});e=new THREE.Mesh(p,T);geometry=new THREE.EdgesGeometry(e.geometry);c=new THREE.LineSegments(geometry,H);if(V.add(e),V.add(c),path=n.path,path.forEach(function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2];e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new THREE.Vector3(p2[0],p2[1],p2[2]));e=new THREE.Line(e,x);e.material.linewidth=4,e.name="pathvectors",V.add(e)}),this.update_pathVector=function(e){console.log("calling update_pathVector");for(var t=V.getObjectByName("pathvectors");t;)t=V.getObjectByName("pathvectors"),V.remove(t);e.forEach(function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2];e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new THREE.Vector3(p2[0],p2[1],p2[2]));e=new THREE.Line(e,x);e.material.linewidth=4,e.name="pathvectors",V.add(e)}),k()},y)for(var d in kpoints_abs=n.explicit_kpoints_abs,kpoints_abs){pos=kpoints_abs[d],radius=.005*max_b_length;var h,a=new THREE.SphereGeometry(radius,16,16);(h=new THREE.Mesh(a,S)).translateX(pos[0]),h.translateY(pos[1]),h.translateZ(pos[2]),h.name="kpts",V.add(h)}k();function E(e,t){t=void 0===t?!w.enabled:t,w.enabled=t,elems=i.getElementsByClassName("BZDoubleClickText");for(var n=0;n<elems.length;n++)i.removeChild(elems[n]);t||i.appendChild(z("BZDoubleClickText"))}var u;!1===o&&(E(force_status=!1),myBtn=i.querySelector(".DouButton"),myBtn.onclick=function(){E()}),toggle_visibility=function(e){0===T.opacity?T.opacity=.3:T.opacity=0,T.needsUpdate=!0,k()},this.set_visibility=function(e){T.opacity=e?.3:0,T.needsUpdate=!0,k()};var m=!(this.update_kpts=function(e){for(var t,n=V.getObjectByName("kpts");n;)n=V.getObjectByName("kpts"),V.remove(n);for(t in e){pos=e[t],radius=.008*max_b_length;var o=new THREE.SphereGeometry(radius,16,16),o=new THREE.Mesh(o,S);o.translateX(pos[0]),o.translateY(pos[1]),o.translateZ(pos[2]),o.name="kpts",V.add(o)}k()});i.addEventListener("touchend",function(e){void 0!==u&&clearTimeout(u),m?(m=!1,e.preventDefault(),E()):0==e.targetTouches.length?(m=!0,u=setTimeout(function(){m=!1},500)):void 0!==u&&(clearTimeout(u),m=!1)}),i.addEventListener("touchcancel",function(e){void 0!==u&&(clearTimeout(u),m=!1)}),i.addEventListener("touchmove",function(e){void 0!==u&&(clearTimeout(u),m=!1)}),1==_&&(console.log(JSON.stringify(C)),console.log("setting cam at end of loadbz"));t=new THREE.Vector3;O.getWorldDirection(t),console.log("worlddir at end of loadbz is"),console.log(JSON.stringify(t))},this.initBZ=function(e,t,n,o){L=e;var i=document.getElementById(e),e=window.devicePixelRatio||1;for(document.getElementById(t).innerHTML="";i.firstChild;)i.removeChild(i.firstChild);R=[],V=new THREE.Scene,canvas3d_width=i.offsetWidth,canvas3d_height=i.offsetHeight,O=new THREE.PerspectiveCamera(45,canvas3d_width/canvas3d_height,.01,1e3),null!=w&&(console.log(JSON.stringify(C)),O.getWorldDirection(worlddir),console.log("worlddir after camera declaration is"),console.log(JSON.stringify(worlddir))),v?(j=new THREE.SVGRenderer).setQuality("high"):j=new THREE.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0}),j.setClearColor(16777215,0),j.setSize(canvas3d_width*e,canvas3d_height*e),j.domElement.style.width=canvas3d_width+"px",j.domElement.style.height=canvas3d_height+"px",j.domElement.width=canvas3d_width*e,j.domElement.height=canvas3d_height*e,i.appendChild(j.domElement),(w=new THREE.OrbitControls(O,j.domElement)).addEventListener("change",k),w.enableDamping=!0,w.dampingFactor=.25,w.enableZoom=!0,special_points=n.kpoints,b1=n.b1,b2=n.b2,b3=n.b3,max_b_length=Math.sqrt(Math.max(Math.pow(b1[0],2)+Math.pow(b1[1],2)+Math.pow(b1[2],2),Math.pow(b2[0],2)+Math.pow(b2[1],2)+Math.pow(b2[2],2),Math.pow(b3[0],2)+Math.pow(b3[1],2)+Math.pow(b3[2],2)));var r=1.5*max_b_length;for(s in O.position.z=3*max_b_length,data=n.faces_data,special_points){pos=special_points[s],radius=.02*max_b_length;var a=new THREE.SphereGeometry(radius,16,16);(d=new THREE.Mesh(a,M)).translateX(pos[0]),d.translateY(pos[1]),d.translateZ(pos[2]),V.add(d);var s=prettifyLabel(s,forSVG=v),l=A(s);v?(j.domElement.appendChild(l),R.push([new THREE.Vector3(pos[0],pos[1],pos[2]),s])):(i.appendChild(l),R.push([new THREE.Vector3(pos[0],pos[1],pos[2]),l]))}f&&(axesLabels=[[new THREE.Vector3(1,0,0),'<span style="font-style: italic">x</span>'],[new THREE.Vector3(0,1,0),'<span style="font-style: italic">y</span>'],[new THREE.Vector3(0,0,1),'<span style="font-style: italic">z</span>']],v&&(axesLabels=[[new THREE.Vector3(1,0,0),'<tspan style="font-style: italic">x</tspan>'],[new THREE.Vector3(0,1,0),'<tspan style="font-style: italic">y</tspan>'],[new THREE.Vector3(0,0,1),'<tspan style="font-style: italic">z</tspan>']]),axesLabels.forEach(function(e){dir=e[0],s=e[1];var t=new THREE.Vector3(0,0,0),e=new THREE.ArrowHelper(dir,t,r,5592405,headLength=r/10,headwidth=r/20);V.add(e),the_color="#555555",l=A(s,color=the_color),pos=dir.clone(),pos.sub(t),pos.multiplyScalar(r),v?(j.domElement.appendChild(l),R.push([pos,s,the_color])):(i.appendChild(l),R.push([pos,l]))}));t=[[b1,'<span style="font-weight: bold">b</span><sub>1</sub>'],[b2,'<span style="font-weight: bold">b</span><sub>2</sub>'],[b3,'<span style="font-weight: bold">b</span><sub>3</sub>']];v&&(t=[[b1,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">1</tspan>'],[b2,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">2</tspan>'],[b3,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">3</tspan>']]),(t=!g?[]:t).forEach(function(e){b=e[0],s=e[1],b_length=Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)),dir=new THREE.Vector3(b[0]/b_length,b[1]/b_length,b[2]/b_length);var t=new THREE.Vector3(0,0,0),e=new THREE.ArrowHelper(dir,t,length=b_length,0,headLength=b_length/10,headwidth=b_length/20);V.add(e);e=A(s);pos=dir.clone(),pos.sub(t),pos.multiplyScalar(b_length),v?(j.domElement.appendChild(e),R.push([pos,s])):(i.appendChild(e),R.push([pos,e]))});var c=new THREE.Geometry;data.triangles_vertices.forEach(function(e){c.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))}),data.triangles.forEach(function(e){c.faces.push(new THREE.Face3(e[0],e[1],e[2]))});e=new THREE.Mesh(c,T);geometry=new THREE.EdgesGeometry(e.geometry);t=new THREE.LineSegments(geometry,H);if(V.add(e),V.add(t),path=n.path,path.forEach(function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2];e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new THREE.Vector3(p2[0],p2[1],p2[2]));e=new THREE.Line(e,x);e.material.linewidth=4,e.name="pathvectors",V.add(e)}),this.update_pathVector=function(e){console.log("calling update_pathVector");for(var t=V.getObjectByName("pathvectors");t;)t=V.getObjectByName("pathvectors"),V.remove(t);e.forEach(function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2];e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new THREE.Vector3(p2[0],p2[1],p2[2]));e=new THREE.Line(e,x);e.material.linewidth=4,e.name="pathvectors",V.add(e)}),k()},y)for(var p in kpoints_abs=n.explicit_kpoints_abs,kpoints_abs){pos=kpoints_abs[p],radius=.005*max_b_length;var d,a=new THREE.SphereGeometry(radius,16,16);(d=new THREE.Mesh(a,S)).translateX(pos[0]),d.translateY(pos[1]),d.translateZ(pos[2]),d.name="kpts",V.add(d)}k();function h(e,t){t=void 0===t?!w.enabled:t,w.enabled=t,elems=i.getElementsByClassName("BZDoubleClickText");for(var n=0;n<elems.length;n++)i.removeChild(elems[n]);t||i.appendChild(z("BZDoubleClickText"))}var E;!1===o&&(h(force_status=!1),myBtn=i.querySelector(".DouButton"),myBtn.onclick=function(){h()}),toggle_visibility=function(e){0===T.opacity?T.opacity=.3:T.opacity=0,T.needsUpdate=!0,k()},this.set_visibility=function(e){T.opacity=e?.3:0,T.needsUpdate=!0,k()};var u=!(this.update_kpts=function(e){for(var t,n=V.getObjectByName("kpts");n;)n=V.getObjectByName("kpts"),V.remove(n);for(t in e){pos=e[t],radius=.008*max_b_length;var o=new THREE.SphereGeometry(radius,16,16),o=new THREE.Mesh(o,S);o.translateX(pos[0]),o.translateY(pos[1]),o.translateZ(pos[2]),o.name="kpts",V.add(o)}k()});i.addEventListener("touchend",function(e){void 0!==E&&clearTimeout(E),u?(u=!1,e.preventDefault(),h()):0==e.targetTouches.length?(u=!0,E=setTimeout(function(){u=!1},500)):void 0!==E&&(clearTimeout(E),u=!1)}),i.addEventListener("touchcancel",function(e){void 0!==E&&(clearTimeout(E),u=!1)}),i.addEventListener("touchmove",function(e){void 0!==E&&(clearTimeout(E),u=!1)})}};module.exports={BZVisualizer:BZVisualizer};